window.rangy=function(){function E(i,f){var c=typeof i[f];return c=="function"||!!(c=="object"&&i[f])||c=="unknown";}function g(f,c){return !!(typeof f[c]=="object"&&f[c]);}function o(f,c){return typeof f[c]!="undefined";}function j(c){return function(i,f){for(var k=f.length;k--;){if(!c(i,f[k])){return false;}}return true;};}function h(c){return c&&B(c,m)&&p(c,s);}function w(c){window.alert("Rangy not supported in your browser. Reason: "+c);M.initialized=true;M.supported=false;}function d(){if(!M.initialized){var i,f=false,c=false;if(E(document,"createRange")){i=document.createRange();if(B(i,D)&&p(i,G)){f=true;}i.detach();}if((i=g(document,"body")?document.body:document.getElementsByTagName("body")[0])&&E(i,"createTextRange")){i=i.createTextRange();if(h(i)){c=true;}}!f&&!c&&w("Neither Range nor TextRange are implemented");M.initialized=true;M.features={implementsDomRange:f,implementsTextRange:c};f=F.concat(J);c=0;for(i=f.length;c<i;++c){try{f[c](M);}catch(k){g(window,"console")&&E(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",k);}}}}function b(c){this.name=c;this.supported=this.initialized=false;}var G=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],D=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],m=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],B=j(E),y=j(g),p=j(o),M={version:"1.2.3",initialized:false,supported:true,util:{isHostMethod:E,isHostObject:g,isHostProperty:o,areHostMethods:B,areHostObjects:y,areHostProperties:p,isTextRange:h},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};M.fail=w;M.warn=function(c){c="Rangy warning: "+c;if(M.config.alertOnWarn){window.alert(c);}else{typeof window.console!="undefined"&&typeof window.console.log!="undefined"&&window.console.log(c);}};if({}.hasOwnProperty){M.util.extend=function(i,f){for(var c in f){if(f.hasOwnProperty(c)){i[c]=f[c];}}};}else{w("hasOwnProperty not supported");}var J=[],F=[];M.init=d;M.addInitListener=function(c){M.initialized?c(M):J.push(c);};var u=[];M.addCreateMissingNativeApiListener=function(c){u.push(c);};M.createMissingNativeApi=function(i){i=i||window;d();for(var f=0,c=u.length;f<c;++f){u[f](i);}};b.prototype.fail=function(c){this.initialized=true;this.supported=false;throw Error("Module '"+this.name+"' failed to load: "+c);};b.prototype.warn=function(c){M.warn("Module "+this.name+": "+c);};b.prototype.createError=function(c){return Error("Error in Rangy "+this.name+" module: "+c);};M.createModule=function(i,f){var c=new b(i);M.modules[i]=c;F.push(function(k){f(k,c);c.initialized=true;c.supported=true;});};M.requireModules=function(k){for(var i=0,f=k.length,l,c;i<f;++i){c=k[i];l=M.modules[c];if(!l||!(l instanceof b)){throw Error("Module '"+c+"' not found");}if(!l.supported){throw Error("Module '"+c+"' not supported");}}};var e=false;y=function(){if(!e){e=true;M.initialized||d();}};if(typeof window=="undefined"){w("No window found");}else{if(typeof document=="undefined"){w("No document found");}else{E(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",y,false);if(E(window,"addEventListener")){window.addEventListener("load",y,false);}else{E(window,"attachEvent")?window.attachEvent("onload",y):w("Window does not have required addEventListener or attachEvent method");}return M;}}}();rangy.createModule("DomUtil",function(f,m){function s(l){for(var i=0;l=l.previousSibling;){i++;}return i;}function p(q,n){var i=[],l;for(l=q;l;l=l.parentNode){i.push(l);}for(l=n;l;l=l.parentNode){if(r(i,l)){return l;}}return null;}function k(n,l,i){for(i=i?n:n.parentNode;i;){n=i.parentNode;if(n===l){return i;}i=n;}return null;}function c(i){i=i.nodeType;return i==3||i==4||i==8;}function j(q,n){var i=n.nextSibling,l=n.parentNode;i?l.insertBefore(q,i):l.appendChild(q);return q;}function h(i){if(i.nodeType==9){return i;}else{if(typeof i.ownerDocument!="undefined"){return i.ownerDocument;}else{if(typeof i.document!="undefined"){return i.document;}else{if(i.parentNode){return h(i.parentNode);}else{throw Error("getDocument: no document found for node");}}}}}function g(i){if(!i){return"[No node]";}return c(i)?'"'+i.data+'"':i.nodeType==1?"<"+i.nodeName+(i.id?' id="'+i.id+'"':"")+">["+i.childNodes.length+"]":i.nodeName;}function e(i){this._next=this.root=i;}function u(l,i){this.node=l;this.offset=i;}function o(i){this.code=this[i];this.codeName=i;this.message="DOMException: "+this.codeName;}var d=f.util;d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||m.fail("document missing a Node creation method");d.isHostMethod(document,"getElementsByTagName")||m.fail("document missing getElementsByTagName method");var b=document.createElement("div");d.areHostMethods(b,["insertBefore","appendChild","cloneNode"])||m.fail("Incomplete Element implementation");d.isHostProperty(b,"innerHTML")||m.fail("Element is missing innerHTML property");b=document.createTextNode("test");d.areHostMethods(b,["splitText","deleteData","insertData","appendData","cloneNode"])||m.fail("Incomplete Text Node implementation");var r=function(n,l){for(var i=n.length;i--;){if(n[i]===l){return true;}}return false;};e.prototype={_current:null,hasNext:function(){return !!this._next;},next:function(){var l=this._current=this._next,i;if(this._current){if(i=l.firstChild){this._next=i;}else{for(i=null;l!==this.root&&!(i=l.nextSibling);){l=l.parentNode;}this._next=i;}}return this._current;},detach:function(){this._current=this._next=this.root=null;}};u.prototype={equals:function(i){return this.node===i.node&this.offset==i.offset;},inspect:function(){return"[DomPosition("+g(this.node)+":"+this.offset+")]";}};o.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};o.prototype.toString=function(){return this.message;};f.dom={arrayContains:r,isHtmlNamespace:function(l){var i;return typeof l.namespaceURI=="undefined"||(i=l.namespaceURI)===null||i=="http://www.w3.org/1999/xhtml";},parentElement:function(i){i=i.parentNode;return i.nodeType==1?i:null;},getNodeIndex:s,getNodeLength:function(l){var i;return c(l)?l.length:(i=l.childNodes)?i.length:0;},getCommonAncestor:p,isAncestorOf:function(n,l,i){for(l=i?l:l.parentNode;l;){if(l===n){return true;}else{l=l.parentNode;}}return false;},getClosestAncestorIn:k,isCharacterDataNode:c,insertAfter:j,splitDataNode:function(n,l){var i=n.cloneNode(false);i.deleteData(0,l);n.deleteData(l,n.length-l);j(i,n);return i;},getDocument:h,getWindow:function(i){i=h(i);if(typeof i.defaultView!="undefined"){return i.defaultView;}else{if(typeof i.parentWindow!="undefined"){return i.parentWindow;}else{throw Error("Cannot get a window object for node");}}},getIframeWindow:function(i){if(typeof i.contentWindow!="undefined"){return i.contentWindow;}else{if(typeof i.contentDocument!="undefined"){return i.contentDocument.defaultView;}else{throw Error("getIframeWindow: No Window object found for iframe element");}}},getIframeDocument:function(i){if(typeof i.contentDocument!="undefined"){return i.contentDocument;}else{if(typeof i.contentWindow!="undefined"){return i.contentWindow.document;}else{throw Error("getIframeWindow: No Document object found for iframe element");}}},getBody:function(i){return d.isHostObject(i,"body")?i.body:i.getElementsByTagName("body")[0];},getRootContainer:function(l){for(var i;i=l.parentNode;){l=i;}return l;},comparePoints:function(t,q,l,n){var i;if(t==l){return q===n?0:q<n?-1:1;}else{if(i=k(l,t,true)){return q<=s(i)?-1:1;}else{if(i=k(t,l,true)){return s(i)<n?-1:1;}else{q=p(t,l);t=t===q?q:k(t,q,true);l=l===q?q:k(l,q,true);if(t===l){throw Error("comparePoints got to case 4 and childA and childB are the same!");}else{for(q=q.firstChild;q;){if(q===t){return -1;}else{if(q===l){return 1;}}q=q.nextSibling;}throw Error("Should not be here!");}}}}},inspectNode:g,fragmentFromNodeChildren:function(n){for(var l=h(n).createDocumentFragment(),i;i=n.firstChild;){l.appendChild(i);}return l;},createIterator:function(i){return new e(i);},DomPosition:u};f.DOMException=o;});rangy.createModule("DomRange",function(aL){function af(b,c){return b.nodeType!=3&&(aP.isAncestorOf(b,c.startContainer,true)||aP.isAncestorOf(b,c.endContainer,true));}function ai(b){return aP.getDocument(b.startContainer);}function ah(b,f,c){if(f=b._listeners[f]){for(var g=0,d=f.length;g<d;++g){f[g].call(b,{target:b,args:c});}}}function ay(b){return new m(b.parentNode,aP.getNodeIndex(b));}function al(b){return new m(b.parentNode,aP.getNodeIndex(b)+1);}function ac(b,d,c){var f=b.nodeType==11?b.firstChild:b;if(aP.isCharacterDataNode(d)){c==d.length?aP.insertAfter(b,d):d.parentNode.insertBefore(b,c==0?d:aP.splitDataNode(d,c));}else{c>=d.childNodes.length?d.appendChild(b):d.insertBefore(b,d.childNodes[c]);}return f;}function ab(b){for(var d,c,f=ai(b.range).createDocumentFragment();c=b.next();){d=b.isPartiallySelectedSubtree();c=c.cloneNode(!d);if(d){d=b.getSubtreeIterator();c.appendChild(ab(d));d.detach(true);}if(c.nodeType==10){throw new T("HIERARCHY_REQUEST_ERR");}f.appendChild(c);}return f;}function aN(b,f,c){var g,d;for(c=c||{stop:false};g=b.next();){if(b.isPartiallySelectedSubtree()){if(f(g)===false){c.stop=true;return;}else{g=b.getSubtreeIterator();aN(g,f,c);g.detach(true);if(c.stop){return;}}}else{for(g=aP.createIterator(g);d=g.next();){if(f(d)===false){c.stop=true;return;}}}}}function aK(b){for(var c;b.next();){if(b.isPartiallySelectedSubtree()){c=b.getSubtreeIterator();aK(c);c.detach(true);}else{b.remove();}}}function aG(b){for(var d,c=ai(b.range).createDocumentFragment(),f;d=b.next();){if(b.isPartiallySelectedSubtree()){d=d.cloneNode(false);f=b.getSubtreeIterator();d.appendChild(aG(f));f.detach(true);}else{b.remove();}if(d.nodeType==10){throw new T("HIERARCHY_REQUEST_ERR");}c.appendChild(d);}return c;}function aA(c,h,f){var i=!!(h&&h.length),g,d=!!f;if(i){g=RegExp("^("+h.join("|")+")$");}var b=[];aN(new aI(c,false),function(k){if((!i||g.test(k.nodeType))&&(!d||f(k))){b.push(k);}});return b;}function an(b){return"["+(typeof b.getName=="undefined"?"Range":b.getName())+"("+aP.inspectNode(b.startContainer)+":"+b.startOffset+", "+aP.inspectNode(b.endContainer)+":"+b.endOffset+")]";}function aI(b,d){this.range=b;this.clonePartiallySelectedTextNodes=d;if(!b.collapsed){this.sc=b.startContainer;this.so=b.startOffset;this.ec=b.endContainer;this.eo=b.endOffset;var c=b.commonAncestorContainer;if(this.sc===this.ec&&aP.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc;}else{this._first=this._next=this.sc===c&&!aP.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:aP.getClosestAncestorIn(this.sc,c,true);this._last=this.ec===c&&!aP.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:aP.getClosestAncestorIn(this.ec,c,true);}}}function aD(b){this.code=this[b];this.codeName=b;this.message="RangeException: "+this.codeName;}function aS(b,d,c){this.nodes=aA(b,d,c);this._next=this.nodes[0];this._position=0;}function aQ(b){return function(f,c){for(var g,d=c?f:f.parentNode;d;){g=d.nodeType;if(aP.arrayContains(b,g)){return d;}d=d.parentNode;}return null;};}function aM(b,c){if(aj(b,c)){throw new aD("INVALID_NODE_TYPE_ERR");}}function aH(b){if(!b.startContainer){throw new T("INVALID_STATE_ERR");}}function ae(b,c){if(!aP.arrayContains(c,b.nodeType)){throw new aD("INVALID_NODE_TYPE_ERR");}}function aJ(b,c){if(c<0||c>(aP.isCharacterDataNode(b)?b.length:b.childNodes.length)){throw new T("INDEX_SIZE_ERR");}}function aE(b,c){if(aO(b,true)!==aO(c,true)){throw new T("WRONG_DOCUMENT_ERR");}}function aB(b){if(ak(b,true)){throw new T("NO_MODIFICATION_ALLOWED_ERR");}}function am(b,c){if(!b){throw new T(c);}}function Q(b){return !!b.startContainer&&!!b.endContainer&&!(!aP.arrayContains(aU,b.startContainer.nodeType)&&!aO(b.startContainer,true))&&!(!aP.arrayContains(aU,b.endContainer.nodeType)&&!aO(b.endContainer,true))&&b.startOffset<=(aP.isCharacterDataNode(b.startContainer)?b.startContainer.length:b.startContainer.childNodes.length)&&b.endOffset<=(aP.isCharacterDataNode(b.endContainer)?b.endContainer.length:b.endContainer.childNodes.length);}function ag(b){aH(b);if(!Q(b)){throw Error("Range error: Range is no longer valid after DOM mutation ("+b.inspect()+")");}}function av(){}function s(b){b.START_TO_START=ax;b.START_TO_END=az;b.END_TO_END=aF;b.END_TO_START=ar;b.NODE_BEFORE=E;b.NODE_AFTER=aC;b.NODE_BEFORE_AND_AFTER=at;b.NODE_INSIDE=aq;}function F(b){s(b);s(b.prototype);}function ap(b,c){return function(){ag(this);var f=this.startContainer,h=this.startOffset,g=this.commonAncestorContainer,d=new aI(this,true);if(f!==g){f=aP.getClosestAncestorIn(f,g,true);h=al(f);f=h.node;h=h.offset;}aN(d,aB);d.reset();g=b(d);d.detach();c(this,f,h,f,h);return g;};}function aw(b,g,d){function h(i,k){return function(l){aH(this);ae(l,au);ae(aR(l),aU);l=(i?ay:al)(l);(k?f:c)(this,l.node,l.offset);};}function f(i,k,p){var n=i.endContainer,l=i.endOffset;if(k!==i.startContainer||p!==i.startOffset){if(aR(k)!=aR(n)||aP.comparePoints(k,p,n,l)==1){n=k;l=p;}g(i,k,p,n,l);}}function c(i,k,p){var n=i.startContainer,l=i.startOffset;if(k!==i.endContainer||p!==i.endOffset){if(aR(k)!=aR(n)||aP.comparePoints(k,p,n,l)==-1){n=k;l=p;}g(i,n,l,k,p);}}b.prototype=new av;aL.util.extend(b.prototype,{setStart:function(i,k){aH(this);aM(i,true);aJ(i,k);f(this,i,k);},setEnd:function(i,k){aH(this);aM(i,true);aJ(i,k);c(this,i,k);},setStartBefore:h(true,true),setStartAfter:h(false,true),setEndBefore:h(true,false),setEndAfter:h(false,false),collapse:function(i){ag(this);i?g(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):g(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset);},selectNodeContents:function(i){aH(this);aM(i,true);g(this,i,0,i,aP.getNodeLength(i));},selectNode:function(i){aH(this);aM(i,false);ae(i,au);var k=ay(i);i=al(i);g(this,k.node,k.offset,i.node,i.offset);},extractContents:ap(aG,g),deleteContents:ap(aK,g),canSurroundContents:function(){ag(this);aB(this.startContainer);aB(this.endContainer);var i=new aI(this,true),k=i._first&&af(i._first,this)||i._last&&af(i._last,this);i.detach();return !k;},detach:function(){d(this);},splitBoundaries:function(){ag(this);var i=this.startContainer,k=this.startOffset,p=this.endContainer,n=this.endOffset,l=i===p;aP.isCharacterDataNode(p)&&n>0&&n<p.length&&aP.splitDataNode(p,n);if(aP.isCharacterDataNode(i)&&k>0&&k<i.length){i=aP.splitDataNode(i,k);if(l){n-=k;p=i;}else{p==i.parentNode&&n>=aP.getNodeIndex(i)&&n++;}k=0;}g(this,i,k,p,n);},normalizeBoundaries:function(){ag(this);var i=this.startContainer,k=this.startOffset,r=this.endContainer,n=this.endOffset,l=function(t){var u=t.nextSibling;if(u&&u.nodeType==t.nodeType){r=t;n=t.length;t.appendData(u.data);u.parentNode.removeChild(u);}},p=function(u){var v=u.previousSibling;if(v&&v.nodeType==u.nodeType){i=u;var t=u.length;k=v.length;u.insertData(0,v.data);v.parentNode.removeChild(v);if(i==r){n+=k;r=i;}else{if(r==u.parentNode){v=aP.getNodeIndex(u);if(n==v){r=u;n=t;}else{n>v&&n--;}}}}},q=true;if(aP.isCharacterDataNode(r)){r.length==n&&l(r);}else{if(n>0){(q=r.childNodes[n-1])&&aP.isCharacterDataNode(q)&&l(q);}q=!this.collapsed;}if(q){if(aP.isCharacterDataNode(i)){k==0&&p(i);}else{if(k<i.childNodes.length){(l=i.childNodes[k])&&aP.isCharacterDataNode(l)&&p(l);}}}else{i=r;k=n;}g(this,i,k,r,n);},collapseToPoint:function(i,k){aH(this);aM(i,true);aJ(i,k);if(i!==this.startContainer||k!==this.startOffset||i!==this.endContainer||k!==this.endOffset){g(this,i,k,i,k);}}});F(b);}function e(b){b.collapsed=b.startContainer===b.endContainer&&b.startOffset===b.endOffset;b.commonAncestorContainer=b.collapsed?b.startContainer:aP.getCommonAncestor(b.startContainer,b.endContainer);}function j(c,h,f,i,g){var d=c.startContainer!==h||c.startOffset!==f,b=c.endContainer!==i||c.endOffset!==g;c.startContainer=h;c.startOffset=f;c.endContainer=i;c.endOffset=g;e(c);ah(c,"boundarychange",{startMoved:d,endMoved:b});}function ad(b){this.startContainer=b;this.startOffset=0;this.endContainer=b;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};e(this);}aL.requireModules(["DomUtil"]);var aP=aL.dom,m=aP.DomPosition,T=aL.DOMException;aI.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first;},hasNext:function(){return !!this._next;},next:function(){var b=this._current=this._next;if(b){this._next=b!==this._last?b.nextSibling:null;if(aP.isCharacterDataNode(b)&&this.clonePartiallySelectedTextNodes){if(b===this.ec){(b=b.cloneNode(true)).deleteData(this.eo,b.length-this.eo);}if(this._current===this.sc){(b=b.cloneNode(true)).deleteData(0,this.so);}}}return b;},remove:function(){var b=this._current,d,c;if(aP.isCharacterDataNode(b)&&(b===this.sc||b===this.ec)){d=b===this.sc?this.so:0;c=b===this.ec?this.eo:b.length;d!=c&&b.deleteData(d,c-d);}else{b.parentNode&&b.parentNode.removeChild(b);}},isPartiallySelectedSubtree:function(){return af(this._current,this.range);},getSubtreeIterator:function(){var b;if(this.isSingleCharacterDataNode){b=this.range.cloneRange();b.collapse();}else{b=new ad(ai(this.range));var g=this._current,d=g,h=0,f=g,c=aP.getNodeLength(g);if(aP.isAncestorOf(g,this.sc,true)){d=this.sc;h=this.so;}if(aP.isAncestorOf(g,this.ec,true)){f=this.ec;c=this.eo;}j(b,d,h,f,c);}return new aI(b,this.clonePartiallySelectedTextNodes);},detach:function(b){b&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null;}};aD.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};aD.prototype.toString=function(){return this.message;};aS.prototype={_current:null,hasNext:function(){return !!this._next;},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current;},detach:function(){this._current=this._next=this.nodes=null;}};var au=[1,3,4,5,7,8,10],aU=[2,9,11],ao=[1,3,4,5,7,8,10,11],aT=[1,3,4,5,7,8],aR=aP.getRootContainer,aO=aQ([9,11]),ak=aQ([5,6,10,12]),aj=aQ([6,10,12]),U=document.createElement("style"),y=false;try{U.innerHTML="<b>x</b>";y=U.firstChild.nodeType==3;}catch(R){}aL.features.htmlParsingConforms=y;var o=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ax=0,az=1,aF=2,ar=3,E=0,aC=1,at=2,aq=3;av.prototype={attachListener:function(b,c){this._listeners[b].push(c);},compareBoundaryPoints:function(b,d){ag(this);aE(this.startContainer,d.startContainer);var c=b==ar||b==ax?"start":"end",f=b==az||b==ax?"start":"end";return aP.comparePoints(this[c+"Container"],this[c+"Offset"],d[f+"Container"],d[f+"Offset"]);},insertNode:function(b){ag(this);ae(b,ao);aB(this.startContainer);if(aP.isAncestorOf(b,this.startContainer,true)){throw new T("HIERARCHY_REQUEST_ERR");}this.setStartBefore(ac(b,this.startContainer,this.startOffset));},cloneContents:function(){ag(this);var b,c;if(this.collapsed){return ai(this).createDocumentFragment();}else{if(this.startContainer===this.endContainer&&aP.isCharacterDataNode(this.startContainer)){b=this.startContainer.cloneNode(true);b.data=b.data.slice(this.startOffset,this.endOffset);c=ai(this).createDocumentFragment();c.appendChild(b);return c;}else{c=new aI(this,true);b=ab(c);c.detach();}return b;}},canSurroundContents:function(){ag(this);aB(this.startContainer);aB(this.endContainer);var b=new aI(this,true),c=b._first&&af(b._first,this)||b._last&&af(b._last,this);b.detach();return !c;},surroundContents:function(b){ae(b,aT);if(!this.canSurroundContents()){throw new aD("BAD_BOUNDARYPOINTS_ERR");}var c=this.extractContents();if(b.hasChildNodes()){for(;b.lastChild;){b.removeChild(b.lastChild);}}ac(b,this.startContainer,this.startOffset);b.appendChild(c);this.selectNode(b);},cloneRange:function(){ag(this);for(var b=new ad(ai(this)),d=o.length,c;d--;){c=o[d];b[c]=this[c];}return b;},toString:function(){ag(this);var b=this.startContainer;if(b===this.endContainer&&aP.isCharacterDataNode(b)){return b.nodeType==3||b.nodeType==4?b.data.slice(this.startOffset,this.endOffset):"";}else{var c=[];b=new aI(this,true);aN(b,function(d){if(d.nodeType==3||d.nodeType==4){c.push(d.data);}});b.detach();return c.join("");}},compareNode:function(b){ag(this);var d=b.parentNode,c=aP.getNodeIndex(b);if(!d){throw new T("NOT_FOUND_ERR");}b=this.comparePoint(d,c);d=this.comparePoint(d,c+1);return b<0?d>0?at:E:d>0?aC:aq;},comparePoint:function(b,c){ag(this);am(b,"HIERARCHY_REQUEST_ERR");aE(b,this.startContainer);if(aP.comparePoints(b,c,this.startContainer,this.startOffset)<0){return -1;}else{if(aP.comparePoints(b,c,this.endContainer,this.endOffset)>0){return 1;}}return 0;},createContextualFragment:y?function(b){var d=this.startContainer,c=aP.getDocument(d);if(!d){throw new T("INVALID_STATE_ERR");}var f=null;if(d.nodeType==1){f=d;}else{if(aP.isCharacterDataNode(d)){f=aP.parentElement(d);}}f=f===null||f.nodeName=="HTML"&&aP.isHtmlNamespace(aP.getDocument(f).documentElement)&&aP.isHtmlNamespace(f)?c.createElement("body"):f.cloneNode(false);f.innerHTML=b;return aP.fragmentFromNodeChildren(f);}:function(b){aH(this);var c=ai(this).createElement("body");c.innerHTML=b;return aP.fragmentFromNodeChildren(c);},toHtml:function(){ag(this);var b=ai(this).createElement("div");b.appendChild(this.cloneContents());return b.innerHTML;},intersectsNode:function(b,f){ag(this);am(b,"NOT_FOUND_ERR");if(aP.getDocument(b)!==ai(this)){return false;}var c=b.parentNode,g=aP.getNodeIndex(b);am(c,"NOT_FOUND_ERR");var d=aP.comparePoints(c,g,this.endContainer,this.endOffset);c=aP.comparePoints(c,g+1,this.startContainer,this.startOffset);return f?d<=0&&c>=0:d<0&&c>0;},isPointInRange:function(b,c){ag(this);am(b,"HIERARCHY_REQUEST_ERR");aE(b,this.startContainer);return aP.comparePoints(b,c,this.startContainer,this.startOffset)>=0&&aP.comparePoints(b,c,this.endContainer,this.endOffset)<=0;},intersectsRange:function(b,d){ag(this);if(ai(b)!=ai(this)){throw new T("WRONG_DOCUMENT_ERR");}var c=aP.comparePoints(this.startContainer,this.startOffset,b.endContainer,b.endOffset),f=aP.comparePoints(this.endContainer,this.endOffset,b.startContainer,b.startOffset);return d?c<=0&&f>=0:c<0&&f>0;},intersection:function(b){if(this.intersectsRange(b)){var d=aP.comparePoints(this.startContainer,this.startOffset,b.startContainer,b.startOffset),c=aP.comparePoints(this.endContainer,this.endOffset,b.endContainer,b.endOffset),f=this.cloneRange();d==-1&&f.setStart(b.startContainer,b.startOffset);c==1&&f.setEnd(b.endContainer,b.endOffset);return f;}return null;},union:function(b){if(this.intersectsRange(b,true)){var c=this.cloneRange();aP.comparePoints(b.startContainer,b.startOffset,this.startContainer,this.startOffset)==-1&&c.setStart(b.startContainer,b.startOffset);aP.comparePoints(b.endContainer,b.endOffset,this.endContainer,this.endOffset)==1&&c.setEnd(b.endContainer,b.endOffset);return c;}else{throw new aD("Ranges do not intersect");}},containsNode:function(b,c){return c?this.intersectsNode(b,false):this.compareNode(b)==aq;},containsNodeContents:function(b){return this.comparePoint(b,0)>=0&&this.comparePoint(b,aP.getNodeLength(b))<=0;},containsRange:function(b){return this.intersection(b).equals(b);},containsNodeText:function(b){var d=this.cloneRange();d.selectNode(b);var c=d.getNodes([3]);if(c.length>0){d.setStart(c[0],0);b=c.pop();d.setEnd(b,b.length);b=this.containsRange(d);d.detach();return b;}else{return this.containsNodeContents(b);}},createNodeIterator:function(b,c){ag(this);return new aS(this,b,c);},getNodes:function(b,c){ag(this);return aA(this,b,c);},getDocument:function(){return ai(this);},collapseBefore:function(b){aH(this);this.setEndBefore(b);this.collapse(false);},collapseAfter:function(b){aH(this);this.setStartAfter(b);this.collapse(true);},getName:function(){return"DomRange";},equals:function(b){return ad.rangesEqual(this,b);},isValid:function(){return Q(this);},inspect:function(){return an(this);}};aw(ad,j,function(b){aH(b);b.startContainer=b.startOffset=b.endContainer=b.endOffset=null;b.collapsed=b.commonAncestorContainer=null;ah(b,"detach",null);b._listeners=null;});aL.rangePrototype=av.prototype;ad.rangeProperties=o;ad.RangeIterator=aI;ad.copyComparisonConstants=F;ad.createPrototypeRange=aw;ad.inspect=an;ad.getRangeDocument=ai;ad.rangesEqual=function(b,c){return b.startContainer===c.startContainer&&b.startOffset===c.startOffset&&b.endContainer===c.endContainer&&b.endOffset===c.endOffset;};aL.DomRange=ad;aL.RangeException=aD;});rangy.createModule("WrappedRange",function(c){function b(o,s,m,k){var j=o.duplicate();j.collapse(m);var p=j.parentElement();i.isAncestorOf(s,p,true)||(p=s);if(!p.canHaveHTML){return new h(p.parentNode,i.getNodeIndex(p));}s=i.getDocument(p).createElement("span");var l,r=m?"StartToStart":"StartToEnd";do{p.insertBefore(s,s.previousSibling);j.moveToElementText(s);}while((l=j.compareEndPoints(r,o))>0&&s.previousSibling);r=s.nextSibling;if(l==-1&&r&&i.isCharacterDataNode(r)){j.setEndPoint(m?"EndToStart":"EndToEnd",o);if(/[\r\n]/.test(r.data)){p=j.duplicate();m=p.text.replace(/\r\n/g,"\r").length;for(m=p.moveStart("character",m);p.compareEndPoints("StartToEnd",p)==-1;){m++;p.moveStart("character",1);}}else{m=j.text.length;}p=new h(r,m);}else{r=(k||!m)&&s.previousSibling;p=(m=(k||m)&&s.nextSibling)&&i.isCharacterDataNode(m)?new h(m,0):r&&i.isCharacterDataNode(r)?new h(r,r.length):new h(p,i.getNodeIndex(s));}s.parentNode.removeChild(s);return p;}function e(o,s){var m,k,j=o.offset,p=i.getDocument(o.node),l=p.body.createTextRange(),r=i.isCharacterDataNode(o.node);if(r){m=o.node;k=m.parentNode;}else{m=o.node.childNodes;m=j<m.length?m[j]:null;k=o.node;}p=p.createElement("span");p.innerHTML="&#feff;";m?k.insertBefore(p,m):k.appendChild(p);l.moveToElementText(p);l.collapse(!s);k.removeChild(p);if(r){l[s?"moveStart":"moveEnd"]("character",j);}return l;}c.requireModules(["DomUtil","DomRange"]);var d,i=c.dom,h=i.DomPosition,g=c.DomRange;if(c.features.implementsDomRange&&(!c.features.implementsTextRange||!c.config.preferTextRange)){(function(){function o(t){for(var n=m.length,q;n--;){q=m[n];t[q]=t.nativeRange[q];}}var s,m=g.rangeProperties,k,j;d=function(n){if(!n){throw Error("Range must be specified");}this.nativeRange=n;o(this);};g.createPrototypeRange(d,function(w,q,v,n,x){var t=w.endContainer!==n||w.endOffset!=x;if(w.startContainer!==q||w.startOffset!=v||t){w.setEnd(n,x);w.setStart(q,v);}},function(t){t.nativeRange.detach();t.detached=true;for(var n=m.length,q;n--;){q=m[n];t[q]=null;}});s=d.prototype;s.selectNode=function(n){this.nativeRange.selectNode(n);o(this);};s.deleteContents=function(){this.nativeRange.deleteContents();o(this);};s.extractContents=function(){var n=this.nativeRange.extractContents();o(this);return n;};s.cloneContents=function(){return this.nativeRange.cloneContents();};s.surroundContents=function(n){this.nativeRange.surroundContents(n);o(this);};s.collapse=function(n){this.nativeRange.collapse(n);o(this);};s.cloneRange=function(){return new d(this.nativeRange.cloneRange());};s.refresh=function(){o(this);};s.toString=function(){return this.nativeRange.toString();};var p=document.createTextNode("test");i.getBody(document).appendChild(p);var l=document.createRange();l.setStart(p,0);l.setEnd(p,0);try{l.setStart(p,1);k=true;s.setStart=function(q,n){this.nativeRange.setStart(q,n);o(this);};s.setEnd=function(q,n){this.nativeRange.setEnd(q,n);o(this);};j=function(n){return function(q){this.nativeRange[n](q);o(this);};};}catch(r){k=false;s.setStart=function(t,n){try{this.nativeRange.setStart(t,n);}catch(q){this.nativeRange.setEnd(t,n);this.nativeRange.setStart(t,n);}o(this);};s.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n);}catch(q){this.nativeRange.setStart(t,n);this.nativeRange.setEnd(t,n);}o(this);};j=function(q,n){return function(u){try{this.nativeRange[q](u);}catch(t){this.nativeRange[n](u);this.nativeRange[q](u);}o(this);};};}s.setStartBefore=j("setStartBefore","setEndBefore");s.setStartAfter=j("setStartAfter","setEndAfter");s.setEndBefore=j("setEndBefore","setStartBefore");s.setEndAfter=j("setEndAfter","setStartAfter");l.selectNodeContents(p);s.selectNodeContents=l.startContainer==p&&l.endContainer==p&&l.startOffset==0&&l.endOffset==p.length?function(n){this.nativeRange.selectNodeContents(n);o(this);}:function(n){this.setStart(n,0);this.setEnd(n,g.getEndOffset(n));};l.selectNodeContents(p);l.setEnd(p,3);k=document.createRange();k.selectNodeContents(p);k.setEnd(p,4);k.setStart(p,2);s.compareBoundaryPoints=l.compareBoundaryPoints(l.START_TO_END,k)==-1&l.compareBoundaryPoints(l.END_TO_START,k)==1?function(q,n){n=n.nativeRange||n;if(q==n.START_TO_END){q=n.END_TO_START;}else{if(q==n.END_TO_START){q=n.START_TO_END;}}return this.nativeRange.compareBoundaryPoints(q,n);}:function(q,n){return this.nativeRange.compareBoundaryPoints(q,n.nativeRange||n);};if(c.util.isHostMethod(l,"createContextualFragment")){s.createContextualFragment=function(n){return this.nativeRange.createContextualFragment(n);};}i.getBody(document).removeChild(p);l.detach();k.detach();})();c.createNativeRange=function(j){j=j||document;return j.createRange();};}else{if(c.features.implementsTextRange){d=function(j){this.textRange=j;this.refresh();};d.prototype=new g(document);d.prototype.refresh=function(){var l,m,k=this.textRange;l=k.parentElement();var j=k.duplicate();j.collapse(true);m=j.parentElement();j=k.duplicate();j.collapse(false);k=j.parentElement();m=m==k?m:i.getCommonAncestor(m,k);m=m==l?m:i.getCommonAncestor(l,m);if(this.textRange.compareEndPoints("StartToEnd",this.textRange)==0){m=l=b(this.textRange,m,true,true);}else{l=b(this.textRange,m,true,false);m=b(this.textRange,m,false,false);}this.setStart(l.node,l.offset);this.setEnd(m.node,m.offset);};g.copyComparisonConstants(d);var f=function(){return this;}();if(typeof f.Range=="undefined"){f.Range=d;}c.createNativeRange=function(j){j=j||document;return j.body.createTextRange();};}}if(c.features.implementsTextRange){d.rangeToTextRange=function(k){if(k.collapsed){return e(new h(k.startContainer,k.startOffset),true);}else{var l=e(new h(k.startContainer,k.startOffset),true),j=e(new h(k.endContainer,k.endOffset),false);k=i.getDocument(k.startContainer).body.createTextRange();k.setEndPoint("StartToStart",l);k.setEndPoint("EndToEnd",j);return k;}};}d.prototype.getName=function(){return"WrappedRange";};c.WrappedRange=d;c.createRange=function(j){j=j||document;return new d(c.createNativeRange(j));};c.createRangyRange=function(j){j=j||document;return new g(j);};c.createIframeRange=function(j){return c.createRange(i.getIframeDocument(j));};c.createIframeRangyRange=function(j){return c.createRangyRange(i.getIframeDocument(j));};c.addCreateMissingNativeApiListener(function(j){j=j.document;if(typeof j.createRange=="undefined"){j.createRange=function(){return c.createRange(this);};}j=j=null;});});rangy.createModule("WrappedSelection",function(ao,F){function Q(c){return(c||window).getSelection();}function P(c){return(c||window).document.selection;}function ae(c,i,f){var g=f?"end":"start";f=f?"start":"end";c.anchorNode=i[g+"Container"];c.anchorOffset=i[g+"Offset"];c.focusNode=i[f+"Container"];c.focusOffset=i[f+"Offset"];}function R(c){c.anchorNode=c.focusNode=null;c.anchorOffset=c.focusOffset=0;c.rangeCount=0;c.isCollapsed=true;c._ranges.length=0;}function y(c){var f;if(c instanceof ap){f=c._selectionNativeRange;if(!f){f=ao.createNativeRange(au.getDocument(c.startContainer));f.setEnd(c.endContainer,c.endOffset);f.setStart(c.startContainer,c.startOffset);c._selectionNativeRange=f;c.attachListener("detach",function(){this._selectionNativeRange=null;});}}else{if(c instanceof ak){f=c.nativeRange;}else{if(ao.features.implementsDomRange&&c instanceof au.getWindow(c.startContainer).Range){f=c;}}}return f;}function s(c){var i=c.getNodes(),f;a:if(!i.length||i[0].nodeType!=1){f=false;}else{f=1;for(var g=i.length;f<g;++f){if(!au.isAncestorOf(i[0],i[f])){f=false;break a;}}f=true;}if(!f){throw Error("getSingleElementFromRange: range "+c.inspect()+" did not consist of a single element");}return i[0];}function aq(c,g){var f=new ak(g);c._ranges=[f];ae(c,f,false);c.rangeCount=1;c.isCollapsed=f.collapsed;}function an(c){c._ranges.length=0;if(c.docSelection.type=="None"){R(c);}else{var k=c.docSelection.createRange();if(k&&typeof k.text!="undefined"){aq(c,k);}else{c.rangeCount=k.length;for(var g,i=au.getDocument(k.item(0)),f=0;f<c.rangeCount;++f){g=ao.createRange(i);g.selectNode(k.item(f));c._ranges.push(g);}c.isCollapsed=c.rangeCount==1&&c._ranges[0].collapsed;ae(c,c._ranges[c.rangeCount-1],false);}}}function aj(c,n){var i=c.docSelection.createRange(),l=s(n),g=au.getDocument(i.item(0));g=au.getBody(g).createControlRange();for(var k=0,p=i.length;k<p;++k){g.add(i.item(k));}try{g.add(l);}catch(f){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}g.select();an(c);}function af(c,g,f){this.nativeSelection=c;this.docSelection=g;this._ranges=[];this.win=f;this.refresh();}function U(c,l){var g=au.getDocument(l[0].startContainer);g=au.getBody(g).createControlRange();for(var k=0,f;k<rangeCount;++k){f=s(l[k]);try{g.add(f);}catch(i){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}g.select();an(c);}function al(c,f){if(c.anchorNode&&au.getDocument(c.anchorNode)!==au.getDocument(f)){throw new E("WRONG_DOCUMENT_ERR");}}function ah(c){var l=[],g=new am(c.anchorNode,c.anchorOffset),k=new am(c.focusNode,c.focusOffset),f=typeof c.getName=="function"?c.getName():"Selection";if(typeof c.rangeCount!="undefined"){for(var i=0,n=c.rangeCount;i<n;++i){l[i]=ap.inspect(c.getRangeAt(i));}}return"["+f+"(Ranges: "+l.join(", ")+")(anchor: "+g.inspect()+", focus: "+k.inspect()+"]";}ao.requireModules(["DomUtil","DomRange","WrappedRange"]);ao.config.checkSelectionRanges=true;var au=ao.dom,at=ao.util,ap=ao.DomRange,ak=ao.WrappedRange,E=ao.DOMException,am=au.DomPosition,ai,ag,T=ao.util.isHostMethod(window,"getSelection"),m=ao.util.isHostObject(document,"selection"),G=m&&(!T||ao.config.preferTextRange);if(G){ai=P;ao.isSelectionValid=function(c){c=(c||window).document;var f=c.selection;return f.type!="None"||au.getDocument(f.createRange().parentElement())==c;};}else{if(T){ai=Q;ao.isSelectionValid=function(){return true;};}else{F.fail("Neither document.selection or window.getSelection() detected.");}}ao.getNativeSelection=ai;T=ai();var ac=ao.createNativeRange(document),h=au.getBody(document),j=at.areHostObjects(T,at.areHostProperties(T,["anchorOffset","focusOffset"]));ao.features.selectionHasAnchorAndFocus=j;var aa=at.isHostMethod(T,"extend");ao.features.selectionHasExtend=aa;var ad=typeof T.rangeCount=="number";ao.features.selectionHasRangeCount=ad;var b=false,d=true;at.areHostMethods(T,["addRange","getRangeAt","removeAllRanges"])&&typeof T.rangeCount=="number"&&ao.features.implementsDomRange&&function(){var c=document.createElement("iframe");c.frameBorder=0;c.style.position="absolute";c.style.left="-10000px";h.appendChild(c);var k=au.getIframeDocument(c);k.open();k.write("<html><head></head><body>12</body></html>");k.close();var g=au.getIframeWindow(c).getSelection(),i=k.documentElement.lastChild.firstChild;k=k.createRange();k.setStart(i,1);k.collapse(true);g.addRange(k);d=g.rangeCount==1;g.removeAllRanges();var f=k.cloneRange();k.setStart(i,0);f.setEnd(i,2);g.addRange(k);g.addRange(f);b=g.rangeCount==2;k.detach();f.detach();h.removeChild(c);}();ao.features.selectionSupportsMultipleRanges=b;ao.features.collapsedNonEditableSelectionsSupported=d;var D=false,ar;if(h&&at.isHostMethod(h,"createControlRange")){ar=h.createControlRange();if(at.areHostProperties(ar,["item","add"])){D=true;}}ao.features.implementsControlRange=D;ag=j?function(c){return c.anchorNode===c.focusNode&&c.anchorOffset===c.focusOffset;}:function(c){return c.rangeCount?c.getRangeAt(c.rangeCount-1).collapsed:false;};var e;if(at.isHostMethod(T,"getRangeAt")){e=function(c,g){try{return c.getRangeAt(g);}catch(f){return null;}};}else{if(j){e=function(c){var f=au.getDocument(c.anchorNode);f=ao.createRange(f);f.setStart(c.anchorNode,c.anchorOffset);f.setEnd(c.focusNode,c.focusOffset);if(f.collapsed!==this.isCollapsed){f.setStart(c.focusNode,c.focusOffset);f.setEnd(c.anchorNode,c.anchorOffset);}return f;};}}ao.getSelection=function(c){c=c||window;var i=c._rangySelection,f=ai(c),g=m?P(c):null;if(i){i.nativeSelection=f;i.docSelection=g;i.refresh(c);}else{i=new af(f,g,c);c._rangySelection=i;}return i;};ao.getIframeSelection=function(c){return ao.getSelection(au.getIframeWindow(c));};ar=af.prototype;if(!G&&j&&at.areHostMethods(T,["removeAllRanges","addRange"])){ar.removeAllRanges=function(){this.nativeSelection.removeAllRanges();R(this);};var o=function(c,g){var f=ap.getRangeDocument(g);f=ao.createRange(f);f.collapseToPoint(g.endContainer,g.endOffset);c.nativeSelection.addRange(y(f));c.nativeSelection.extend(g.startContainer,g.startOffset);c.refresh();};ar.addRange=ad?function(c,g){if(D&&m&&this.docSelection.type=="Control"){aj(this,c);}else{if(g&&aa){o(this,c);}else{var f;if(b){f=this.rangeCount;}else{this.removeAllRanges();f=0;}this.nativeSelection.addRange(y(c));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==f+1){if(ao.config.checkSelectionRanges){if((f=e(this.nativeSelection,this.rangeCount-1))&&!ap.rangesEqual(f,c)){c=new ak(f);}}this._ranges[this.rangeCount-1]=c;ae(this,c,X(this.nativeSelection));this.isCollapsed=ag(this);}else{this.refresh();}}}}:function(c,f){if(f&&aa){o(this,c);}else{this.nativeSelection.addRange(y(c));this.refresh();}};ar.setRanges=function(c){if(D&&c.length>1){U(this,c);}else{this.removeAllRanges();for(var g=0,f=c.length;g<f;++g){this.addRange(c[g]);}}};}else{if(at.isHostMethod(T,"empty")&&at.isHostMethod(ac,"select")&&D&&G){ar.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var c;if(this.anchorNode){c=au.getDocument(this.anchorNode);}else{if(this.docSelection.type=="Control"){var g=this.docSelection.createRange();if(g.length){c=au.getDocument(g.item(0)).body.createTextRange();}}}if(c){c.body.createTextRange().select();this.docSelection.empty();}}}catch(f){}R(this);};ar.addRange=function(c){if(this.docSelection.type=="Control"){aj(this,c);}else{ak.rangeToTextRange(c).select();this._ranges[0]=c;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;ae(this,c,false);}};ar.setRanges=function(c){this.removeAllRanges();var f=c.length;if(f>1){U(this,c);}else{f&&this.addRange(c[0]);}};}else{F.fail("No means of selecting a Range or TextRange was found");return false;}}ar.getRangeAt=function(c){if(c<0||c>=this.rangeCount){throw new E("INDEX_SIZE_ERR");}else{return this._ranges[c];}};var ab;if(G){ab=function(c){var f;if(ao.isSelectionValid(c.win)){f=c.docSelection.createRange();}else{f=au.getBody(c.win.document).createTextRange();f.collapse(true);}if(c.docSelection.type=="Control"){an(c);}else{f&&typeof f.text!="undefined"?aq(c,f):R(c);}};}else{if(at.isHostMethod(T,"getRangeAt")&&typeof T.rangeCount=="number"){ab=function(c){if(D&&m&&c.docSelection.type=="Control"){an(c);}else{c._ranges.length=c.rangeCount=c.nativeSelection.rangeCount;if(c.rangeCount){for(var g=0,f=c.rangeCount;g<f;++g){c._ranges[g]=new ao.WrappedRange(c.nativeSelection.getRangeAt(g));}ae(c,c._ranges[c.rangeCount-1],X(c.nativeSelection));c.isCollapsed=ag(c);}else{R(c);}}};}else{if(j&&typeof T.isCollapsed=="boolean"&&typeof ac.collapsed=="boolean"&&ao.features.implementsDomRange){ab=function(c){var f;f=c.nativeSelection;if(f.anchorNode){f=e(f,0);c._ranges=[f];c.rangeCount=1;f=c.nativeSelection;c.anchorNode=f.anchorNode;c.anchorOffset=f.anchorOffset;c.focusNode=f.focusNode;c.focusOffset=f.focusOffset;c.isCollapsed=ag(c);}else{R(c);}};}else{F.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false;}}}ar.refresh=function(c){var f=c?this._ranges.slice(0):null;ab(this);if(c){c=f.length;if(c!=this._ranges.length){return false;}for(;c--;){if(!ap.rangesEqual(f[c],this._ranges[c])){return false;}}return true;}};var av=function(c,l){var g=c.getAllRanges(),k=false;c.removeAllRanges();for(var f=0,i=g.length;f<i;++f){if(k||l!==g[f]){c.addRange(g[f]);}else{k=true;}}c.rangeCount||R(c);};ar.removeRange=D?function(c){if(this.docSelection.type=="Control"){var l=this.docSelection.createRange();c=s(c);var g=au.getDocument(l.item(0));g=au.getBody(g).createControlRange();for(var k,f=false,i=0,n=l.length;i<n;++i){k=l.item(i);if(k!==c||f){g.add(l.item(i));}else{f=true;}}g.select();an(this);}else{av(this,c);}}:function(c){av(this,c);};var X;if(!G&&j&&ao.features.implementsDomRange){X=function(c){var f=false;if(c.anchorNode){f=au.comparePoints(c.anchorNode,c.anchorOffset,c.focusNode,c.focusOffset)==1;}return f;};ar.isBackwards=function(){return X(this);};}else{X=ar.isBackwards=function(){return false;};}ar.toString=function(){for(var c=[],g=0,f=this.rangeCount;g<f;++g){c[g]=""+this._ranges[g];}return c.join("");};ar.collapse=function(c,g){al(this,c);var f=ao.createRange(au.getDocument(c));f.collapseToPoint(c,g);this.removeAllRanges();this.addRange(f);this.isCollapsed=true;};ar.collapseToStart=function(){if(this.rangeCount){var c=this._ranges[0];this.collapse(c.startContainer,c.startOffset);}else{throw new E("INVALID_STATE_ERR");}};ar.collapseToEnd=function(){if(this.rangeCount){var c=this._ranges[this.rangeCount-1];this.collapse(c.endContainer,c.endOffset);}else{throw new E("INVALID_STATE_ERR");}};ar.selectAllChildren=function(c){al(this,c);var f=ao.createRange(au.getDocument(c));f.selectNodeContents(c);this.removeAllRanges();this.addRange(f);};ar.deleteFromDocument=function(){if(D&&m&&this.docSelection.type=="Control"){for(var c=this.docSelection.createRange(),g;c.length;){g=c.item(0);c.remove(g);g.parentNode.removeChild(g);}this.refresh();}else{if(this.rangeCount){c=this.getAllRanges();this.removeAllRanges();g=0;for(var f=c.length;g<f;++g){c[g].deleteContents();}this.addRange(c[f-1]);}}};ar.getAllRanges=function(){return this._ranges.slice(0);};ar.setSingleRange=function(c){this.setRanges([c]);};ar.containsNode=function(c,i){for(var f=0,g=this._ranges.length;f<g;++f){if(this._ranges[f].containsNode(c,i)){return true;}}return false;};ar.toHtml=function(){var c="";if(this.rangeCount){c=ap.getRangeDocument(this._ranges[0]).createElement("div");for(var g=0,f=this._ranges.length;g<f;++g){c.appendChild(this._ranges[g].cloneContents());}c=c.innerHTML;}return c;};ar.getName=function(){return"WrappedSelection";};ar.inspect=function(){return ah(this);};ar.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null;};af.inspect=ah;ao.Selection=af;ao.selectionPrototype=ar;ao.addCreateMissingNativeApiListener(function(c){if(typeof c.getSelection=="undefined"){c.getSelection=function(){return ao.getSelection(this);};}c=null;});});