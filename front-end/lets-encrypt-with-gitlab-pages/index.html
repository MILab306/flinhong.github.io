<!DOCTYPE HTML> <html lang="en"> <head> <meta charset="utf-8"/> <title>Free SSL with Let's Encrypt on GitLab Pages</title> <meta content="IE=edge" http-equiv="X-UA-Compatible"/> <meta content="width=device-width, initial-scale=1" name="viewport"/> <link rel="canonical" href="https://www.flinhong.com/front-end/lets-encrypt-with-gitlab-pages/"/> <meta name="description" content="Nowadays, there is a strong push for using TLS on every website. The ultimate goal is to make the web safer, and Let's Encrypt provide you a free certificate from the comfort of their terminal."/> <meta property="og:type" content="article"/> <meta property="og:title" content="Free SSL with Let's Encrypt on GitLab Pages"/> <meta property="og:description" content="Nowadays, there is a strong push for using TLS on every website. The ultimate goal is to make the web safer, and Let's Encrypt provide you a free certificate from the comfort of their terminal."/> <meta property="og:image" content="/images/201607/lets-encrypt.png"/> <meta property="og:url" content="https://www.flinhong.com/front-end/lets-encrypt-with-gitlab-pages/"/> <meta property="og:site_name" content="Frank Lin"/> <meta name="google-site-verification" content="HXPDAWYIepFJGNogMyAiitfbS7Y1qch0g48wPNEcWe4"/> <meta baidu-gxt-verify-token="71873380879135aeb44e80d9104ecad1"> <meta name="baidu-site-verification" content="UMxw5uvDqa"/> <link rel="shortcut icon" href="/assets/images/favicon.ico"/> <link rel="icon" type="image/png" href="/assets/images/android-chrome-192x192.png" sizes="192x192"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon-180x180.png"> <link rel="stylesheet" type="text/css" href="/css/reset.css" media="screen"/> <link rel="stylesheet" type="text/css" href="/css/font-awesome.min.css" media="screen"/> <link rel="stylesheet" type="text/css" href="/css/dat-menu.css" media="screen"/> <link rel="stylesheet" type="text/css" href="/css/main-stylesheet.css" media="screen"/> <link rel="stylesheet" type="text/css" href="/css/responsive.css" media="screen"/> <link rel="stylesheet" type="text/css" href="/css/syntax.css" media="screen"/> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700|Lato:300,400,700|Source+Sans+Pro:300,400,600,700&amp;subset=latin,latin-ext"/> <!--[if lt IE 9 ]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script> <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]--> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-7353085750925432",enable_page_level_ads:!0});</script> </head> <body class="no-slider"> <div id="slider-imgs"> <div class="featured-img-box"> <div id="featured-img-1" class="featured-img"></div> <div id="featured-img-2" class="featured-img invisible"></div> <div id="featured-img-3" class="featured-img invisible"></div> <div id="featured-img-4" class="featured-img invisible"></div> </div> </div> <div id="top-layer"> <div id="header-top"> <div class="wrapper"> <ul class="right"> <li><a href="http://www.facebook.com/flinhong" target="_blank"><i class="fa fa-facebook"></i></a></li> <li><a href="https://twitter.com/flinhong" target="_blank"><i class="fa fa-twitter"></i></a></li> <li><a href="https://github.com/flinhong" target="_blank"><i class="fa fa-github"></i></a></li> <li><a href="http://weibo.com/linhong" target="_blank"><i class="fa fa-weibo"></i></a></li> <li><a href="https://www.linkedin.com/in/frankhl" target="_blank"><i class="fa fa-linkedin"></i></a></li> <li><a href="https://www.flickr.com/photos/frankhlin/" target="_blank"><i class="fa fa-flickr"></i></a></li> </ul> <ul class="load-responsive" rel="Top menu"> <li><a href="https://www.flinhong.com/search/">Search</a></li> <li><a href="https://www.flinhong.com/feed.xml">RSS Feed</a></li> <li><a href="https://www.flinhong.com/sitemap.xml">Sitemap</a></li> </ul> </div> </div> <section id="content"> <header id="header"> <div id="menu-bottom"> <nav id="menu" class="main-menu"> <div class="blur-before"></div> <a href="https://www.flinhong.com" class="header-logo left"><img src="/assets/images/logo.png" class="logo" alt="Frank's Blog" title="Frank's Blog"/></a> <a href="#dat-menu" class="datmenu-prompt"><i class="fa fa-bars"></i>Show Menu</a> <ul class="load-responsive" rel="Main menu"> <li><a href="https://www.flinhong.com"><i class="fa fa-home" aria-hidden="true"></i></i><strong>Home</strong></a></li> <li><a href="https://www.flinhong.com/blog/"><i class="fa fa-pencil-square-o" aria-hidden="true"></i><strong>Blog</strong></a></li> <li><a href="https://www.flinhong.com/calendar/"><i class="fa fa-calendar-check-o" aria-hidden="true"></i><strong>Calendar</strong></a></li> <li><a href="http://lofter.flinhong.com/"><i class="fa fa-camera-retro"></i><strong>Photo</strong></a></li> <li><a href="https://www.flinhong.com/archives/"><span><i class="fa fa-puzzle-piece"></i><strong>Pages</strong></span></a> <ul class="sub-menu"> <li><a href="https://www.flinhong.com/archives/">Archives</a></li> <li><a href="https://www.flinhong.com/shortcodes/">Shortcodes</a></li> <li><a href="https://www.flinhong.com/sitedoc/">Documentation</a></li> </ul> </li> <li><a href="https://www.flinhong.com/about/"><i class="fa fa-info-circle"></i><strong>About</strong></a></li> <li><a href="https://www.flinhong.com/contact/"><i class="fa fa-map-marker"></i><strong>Contact</strong></a></li> <li><a href="https://www.flinhong.com/feed.xml"><i class="fa fa-rss" aria-hidden="true"></i><strong>RSS</strong></a></li> </ul> </nav> </div> <div class="wrapper"> <div class="header-breadcrumbs"> <h2 class="right">Keep recording...</h2> <ul> <li><a href="https://www.flinhong.com">Homepage</a></li> <li><a href="https://www.flinhong.com/blog/">Blog</a></li> <li><a href="https://www.flinhong.com/categories/front-end">Front-end</a></li> </ul> </div> </div> </header> <div id="main-box"> <div id="main"> <h1><span>Free SSL with Let's Encrypt on GitLab Pages</span></h1> <div class="content-padding"> <div class="article-full"> <div class="article-main-photo"> <img src="/images/201607/lets-encrypt.png" alt="Free SSL with Let's Encrypt on GitLab Pages" title="Free SSL with Let's Encrypt on GitLab Pages"/> </div> <div class="article-icons"> <a href="user-single.html" class="user-tooltip"><i class="fa fa-user"></i>Frank Lin</a> <a href="javascript:;"><i class="fa fa-calendar"></i>July 06, 2016</a> <a href="https://www.flinhong.com/categories/front-end/"><i class="fa fa-tag"></i>Front-end</a> <a href="https://www.flinhong.com/front-end/lets-encrypt-with-gitlab-pages/#disqus_thread" data-disqus-identifier="https://www.flinhong.com//front-end/lets-encrypt-with-gitlab-pages"><i class="fa fa-comments"></i>0 Comment</a> <a href="javascript:;"><i class="fa fa-check-square-o"></i>14458 words.</a> </div> <div class="clear-float do-the-split"></div> <div class="article-content mylist"> <p>In this post we will talk about HTTPS and how to add it to your GitLab Pages site with <a href="https://letsencrypt.org/">Let’s Encrypt</a>. And you can find the original post at <a href="https://about.gitlab.com/2016/04/11/tutorial-securing-your-gitlab-pages-with-tls-and-letsencrypt/">Tutorial: Securing your GitLab Pages with TLS and Let’s Encrypt</a>. Here, I add my own exprience when following its guidance.</p> <h2 id="headid-why-tlsssl">Why TLS/SSL?</h2> <p>When discussing HTTPS, it’s common to hear people saying that a static website doesn’t need HTTPS, since it doesn’t receive any POST requests, or isn’t handling credit card transactions or any other secure request. But that’s not the whole story.</p> <p>TLS (<a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_1.0">formerly SSL</a>) is a security protocol that can be added to HTTP to increase the security of your website by:</p> <ol> <li>properly authenticating yourself: the client can trust that you are really you. The TLS handshake that is made at the beginning of the connection ensures the client that no one is trying to impersonate you;</li> <li>data integrity: this ensures that no one has tampered with the data in a request/response cycle;</li> <li>encryption: this is the main selling point of TLS, but the other two are just as important. This protects the privacy of the communication between client and server.</li> </ol> <p>The TLS layer can be added to other protocols too, such as FTP (making it <a href="https://en.wikipedia.org/wiki/FTPS">FTPS</a>) or WebSockets (making <code class="highlighter-rouge">ws://</code> <code class="highlighter-rouge">wss://</code>).</p> <h2 id="headid-https-everywhere">HTTPS Everywhere</h2> <p>Nowadays, there is a strong push for using TLS on every website. The ultimate goal is to make the web safer, by adding those three components cited above to every website.</p> <p>The first big player was the <a href="https://www.eff.org/https-everywhere">HTTPS Everywhere</a> browser extension. Google has also been using HTTPS compliance to better rank websites since <a href="https://webmasters.googleblog.com/2014/08/https-as-ranking-signal.html">2014</a>.</p> <h2 id="headid-tls-certificates">TLS certificates</h2> <p>In order to add TLS to HTTP, one would need to get a certificate, and until 2015, one would need to either pay for it or figure out how to do it with one of the available <a href="https://en.wikipedia.org/wiki/Certificate_authority">Certificate Authorities</a>.</p> <p>Enter <a href="https://letsencrypt.org/">Let’s Encrypt</a>, a free, automated, and open Certificate Authority. <a href="https://letsencrypt.org/2015/12/03/entering-public-beta.html">Since December 2015</a> anyone can get a free certificate from this new Certificate Authority from the comfort of their terminal.</p> <h2 id="headid-implementation">Implementation</h2> <p>So, let’s suppose we’re going to create a static blog with <a href="https://jekyllrb.com/">Jekyll 3</a>. If you are not creating a blog or are not using Jekyll just follow along, it should be straightforward enough to translate the steps for different purposes.</p> <p>A simple example blog can be created with:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>jekyll new cool-blog
New jekyll site installed <span class="k">in</span> ~/cool-blog.
<span class="gp">$ </span><span class="nb">cd </span>cool-blog/
</code></pre> </div> <p>Now you have to create a GitLab project. Here we are going to create a “user page”, which means that it is a project created within a user account (not a group account), and that the name of the project looks like <code class="highlighter-rouge">YOURUSERNAME.gitlab.io</code>. Refer to the <a href="http://doc.gitlab.com/ee/pages/README.html#getting-started-with-gitlab-pages">“Getting started” section of the GitLab Pages manual</a> for more information on that.</p> <p>If you are using GitHub Pages, its not possible for you to get a SSL for your custom domain at present. So, GitLab might be a good choice if you need the <code class="highlighter-rouge">https</code>.</p> <p>From now on, remember to replace <code class="highlighter-rouge">YOURDOMAIN.com</code> with your custom domain and <code class="highlighter-rouge">YOURUSERNAME</code> with, well, your username. ;)</p> <p>Create a project named <code class="highlighter-rouge">YOURUSERNAME.gitlab.io</code> so that GitLab will identify the project correctly. After that, upload your code to GitLab:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>git remote add origin git@gitlab.com:YOURUSERNAME/YOURUSERNAME.gitlab.io.git
<span class="gp">$ </span>git push -u origin master
</code></pre> </div> <p>OK, so far we have a project uploaded to GitLab, but we haven’t configured GitLab Pages yet. To configure it, just create a <code class="highlighter-rouge">.gitlab-ci.yml</code> file in the root directory of your repository with the following contents:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>pages:
  stage: deploy
  image: ruby:2.3
  script:
    - gem install jekyll
    - jekyll build -d public/
  artifacts:
    paths:
      - public
  only:
    - master
</code></pre> </div> <p>This file instructs GitLab <code class="highlighter-rouge">Runner</code> to deploy by installing Jekyll and building your website under the <code class="highlighter-rouge">public/</code> folder (<code class="highlighter-rouge">jekyll build -d public/</code>). You can find a <a href="https://flinhong.github.io/tips/automated-blog-with-gitlab-ci/">previous post</a> about the GitLab CI for your Jekyll site.</p> <p>While you Wait for the build process to complete, you can track the progress in the Builds page of your project. Once it starts, it probably won’t take longer than a few minutes. Once the build is finished, your website will be available at <code class="highlighter-rouge">https://YOURUSERNAME.gitlab.io</code>. Note that GitLab already provides TLS certificates to all subdomains of <code class="highlighter-rouge">gitlab.io</code> (but it has some limitations, so please <a href="http://doc.gitlab.com/ee/pages/README.html#limitations">refer to the documentation for more</a>). So if you don’t want to add a custom domain, you’re done.</p> <h2 id="headid-configuring-the-tls-certificate-of-your-custom-domain">Configuring the TLS certificate of your custom domain</h2> <p>Once you buy a domain name and point that domain to your GitLab Pages website, you need to configure 2 things:</p> <ol> <li>add the domain to GitLab Pages configuration (<a href="http://doc.gitlab.com/ee/pages/README.html#add-a-custom-domain-to-your-pages-website">see documentation</a>);</li> <li>add your custom certificate to your website.</li> </ol> <p>Once you add your domain, your website will be available under both <code class="highlighter-rouge">http://YOURDOMAIN.com</code> and <code class="highlighter-rouge">https://YOURUSERNAME.gitlab.io</code>.</p> <p>But if you try to access your custom domain with HTTPS (<code class="highlighter-rouge">https://YOURDOMAIN.com</code> in this case), your browser will show that horrible page, saying that things are going wrong and someone is trying to steal your information. <em>Why is that?</em></p> <p>Since GitLab offers TLS certificates to all <code class="highlighter-rouge">gitlab.io</code> pages and your custom domain is just a CNAME over that same domain, GitLab serves the <code class="highlighter-rouge">gitlab.io</code> certificate, and your browser receives mixed messages: on one side, the browser is trying to access <code class="highlighter-rouge">YOURDOMAIN.com</code>, but on the other side it is getting a TLS certificate for <code class="highlighter-rouge">*.gitlab.io</code>, signaling that something is wrong. That’s the same case for GitHub Pages, you can visit your site with https for <code class="highlighter-rouge">*.github.io</code> but not for your custom domain.</p> <p>In order to fix it, you need to obtain a certificate for <code class="highlighter-rouge">YOURDOMAIN.com</code> and add it to GitLab Pages. For that we are going to use Let’s Encrypt.</p> <p>Let’s Encrypt is a new certificate authority that offers both <em>free</em> and <em>automated</em> certificates. That’s perfect for us: we don’t have to pay for having HTTPS and you can do everything within the comfort of your terminal.</p> <p>We begin with downloading the <code class="highlighter-rouge">letsencrypt-auto</code> utility. Open a new terminal window and type:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>git clone https://github.com/letsencrypt/letsencrypt
<span class="gp">$ </span><span class="nb">cd </span>letsencrypt
</code></pre> </div> <p><code class="highlighter-rouge">letsencrypt-auto</code> offers a lot of functionality. For example, if you have a web server running Apache, you could add <code class="highlighter-rouge">letsencrypt-auto --apache</code> inside your webserver and have everything done for you. <code class="highlighter-rouge">letsencrypt</code> targets primarily Unix-like webservers, so the <code class="highlighter-rouge">letsencrypt-auto</code> tool won’t work for Windows users. Check <a href="https://cultiv.nl/blog/lets-encrypt-on-windows/">this tutorial</a> to see how to get Let’s Encrypt certificates while running Windows. But I am not recommend you to use Windows for this process, I have tried but failed…</p> <p>Since we are running on GitLab’s servers instead, we have to do a bit of manual work:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>./letsencrypt-auto certonly -a manual -d YOURDOMAIN.com
<span class="c">#</span>
<span class="c"># If you want to support another domain, www.YOURDOMAIN.com, for example, you</span>
<span class="c"># can add it to the domain list after -d like:</span>
<span class="c"># ./letsencrypt-auto certonly -a manual -d YOURDOMAIN.com -d www.YOURDOMAIN.com</span>
<span class="c">#</span>
</code></pre> </div> <p>I only configured the www subdomain for my site. After you accept that your IP will be publicly logged, a message like the following will appear:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>Make sure your web server displays the following content at
http://YOURDOMAIN.org/.well-known/acme-challenge/5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM
before continuing:

5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM.ewlbSYgvIxVOqiP1lD2zeDKWBGEZMRfO_4kJyLRP_4U

<span class="c">#</span>
<span class="c"># output omitted</span>
<span class="c">#</span>

Press ENTER to <span class="k">continue</span>
</code></pre> </div> <p>Now it is waiting for the server to be correctly configured so it can go on. <strong>Leave this terminal window open</strong> for now.</p> <p>So, the goal is to the make our already-published static website return said token when said URL is requested. That’s easy: create a custom page! Just create a file in your blog folder that looks like this:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>---
layout: null
permalink: /.well-known/acme-challenge/5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM.html
---

5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM.ewlbSYgvIxVOqiP1lD2zeDKWBGEZMRfO_4kJyLRP_4U
</code></pre> </div> <p>This tells Jekyll to create a static page, which you can see at <code class="highlighter-rouge">cool-blog/_site/.well-known/acme-challenge/5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM.html</code>, with no extra HTML, just the token in plain text. As we are using the <code class="highlighter-rouge">permalink</code> attribute in the front matter, you can name this file anyway you want and put it anywhere, too. Note that the behaviour of the <code class="highlighter-rouge">permalink</code> attribute has <a href="https://jekyllrb.com/docs/upgrading/2-to-3/#permalinks-no-longer-automatically-add-a-trailing-slash">changed</a> from Jekyll 2 to Jekyll 3, so make sure you have Jekyll 3.x installed. If you’re not using version 3 of Jekyll or if you’re using a different tool, just create the same file in the exact path, like <code class="highlighter-rouge">cool-blog/.well-known/acme-challenge/5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM.html</code> or an equivalent path in your static site generator of choice. Here we’ll call it <code class="highlighter-rouge">letsencrypt-setup.html</code> and place it in the root folder of the blog. In order to check that everything is working as expected, start a local server with jekyll serve in a separate terminal window and try to access the URL:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl http://localhost:4000/.well-known/acme-challenge/5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM
<span class="c"># response:</span>
5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM.ewlbSYgvIxVOqiP1lD2zeDKWBGEZMRfO_4kJyLRP_4U
</code></pre> </div> <p>Note that I just replaced the <code class="highlighter-rouge">http://YOURDOMAIN.com</code> (from the <code class="highlighter-rouge">letsencrypt-auto</code> instructions) with <code class="highlighter-rouge">http://localhost:4000</code>. Everything is working fine, so we just need to upload the new file to GitLab:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>git add letsencrypt-setup.html
<span class="gp">$ </span>git commit -m <span class="s2">"add letsencypt-setup.html file"</span>
<span class="gp">$ </span>git push
</code></pre> </div> <p>Just because the <code class="highlighter-rouge">permalink</code> attribute, I cannot get the correct response from the url above, and get a <code class="highlighter-rouge">404</code> response. The right response can only curl from the url with <code class="highlighter-rouge">.html</code> ending.</p> <p>For fixing this problem, you can add the following lines in your <code class="highlighter-rouge">.gitlab-ci.yml</code> file after Jekyll build the site in the <code class="highlighter-rouge">public/</code> folder:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>- <span class="nb">cd </span>public
- mkdir -p /.well-known/acme-challenge
- <span class="nb">cd</span> .well-known
- <span class="nb">cd </span>acme-challenge
- <span class="nb">printf</span> <span class="s2">"%s"</span> 5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM.ewlbSYgvIxVOqiP1lD2zeDKWBGEZMRfO_4kJyLRP_4U &gt; 5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM
</code></pre> </div> <p>Once the build finishes, test again if everything is working well:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># Note that we're using the actual domain, not localhost anymore</span>
<span class="gp">$ </span>curl http://YOURDOMAIN.com/.well-known/acme-challenge/5TBu788fW0tQ5EOwZMdu1Gv3e9C33gxjV58hVtWTbDM
</code></pre> </div> <p>Now that everything is working as expected, go back to the terminal window that’s waiting for you and hit <code class="highlighter-rouge">ENTER</code>. This instructs the Let’s Encrypt’s servers to go to the URL we just created. If they get the response they were waiting for, we’ve proven that we actually own the domain and now they’ll send you the TLS certificates. After a while it responds:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at
   /etc/letsencrypt/live/YOURDOMAIN.org/fullchain.pem. Your cert will
   expire on 2016-07-04. To obtain a new version of the certificate <span class="k">in
   </span>the future, simply run Let<span class="s1">'s Encrypt again.
 - If you like Let'</span>s Encrypt, please consider supporting our work by:

   Donating to ISRG / Let<span class="s1">'s Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le
</span></code></pre> </div> <p>Success! We have correctly acquired a free TLS certificate for our domain!</p> <p>Note, however, that like any other TLS certificate, it has an expiration date, and in the case of certificates issued by Let’s Encrypt, the certificate will remain valid for <strong>90 days</strong>. When you finish setting up, just put in your calendar to remember to renew the certificate in time, otherwise it will become invalid, and the browser will reject it.</p> <p>Now we just need to upload the certificate and the key to GitLab. Go to <strong>Settings -&gt; Pages</strong> inside your project, remove the old CNAME and add a new one with the same domain, but now you’ll also upload the TLS certificate. Paste the contents of <code class="highlighter-rouge">/etc/letsencrypt/live/YOURDOMAIN.com/fullchain.pem</code> (you’ll need sudo to read the file) to the “Certificate (PEM)” field and <code class="highlighter-rouge">/etc/letsencrypt/live/YOURDOMAIN.com/privkey.pem</code> (also needs sudo) to the “Key (PEM)” field.</p> <p>You can access your <code class="highlighter-rouge">.pem</code> files by using <code class="highlighter-rouge">sudo su</code> in Ubuntu with <code class="highlighter-rouge">Gedit</code>.</p> <p><img src="/images/201607/gitlab-pages-cert-upload-screenshot.png" alt="GitLab configure"/></p> <p>And you’re done! You now have a fully working HTTPS website:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -vX HEAD https://YOURDOMAIN.com/
<span class="c">#</span>
<span class="c"># starting connection</span>
<span class="c">#</span>
<span class="k">*</span> TLS 1.2 connection using TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA
<span class="k">*</span> Server certificate: YOURDOMAIN.com
<span class="k">*</span> Server certificate: Lets Encrypt Authority X3
<span class="k">*</span> Server certificate: DST Root CA X3
</code></pre> </div> <h2 id="headid-redirecting">Redirecting</h2> <p>Everything is working fine, but now we have an extra concern: we have two working versions of our website, both HTTP and HTTPS. We need a way to redirect all of our traffic to the HTTPS version, and tell search engines to do the same.</p> <h3 id="headid-search-engines">Search Engines</h3> <p>Instructing the search engines is really easy: just tell them that the HTTPS version is the “canonical” version, and they send all the users to it. And how do you do that? By adding a <code class="highlighter-rouge">link</code> tag to the header of the HTML:</p> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"canonical"</span> <span class="na">href=</span><span class="s">"https://YOURDOMAIN.com/specific/page"</span> <span class="nt">/&gt;</span>
</code></pre> </div> <p>Adding this to every header on a blog tells the search engine that the correct version is the HTTPS one, and they’ll comply.</p> <h3 id="headid-internal-links">Internal links</h3> <p>Remember to use HTTPS for your CSS or JavaScript file URLs, because when the browser accesses a secure website that relies on an insecure resource, it may block that resource.</p> <p>It is <a href="http://www.paulirish.com/2010/the-protocol-relative-url/">considered a good practice</a> to use the protocol-agnostic path:</p> <div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"//YOURDOMAIN.com/styles.css"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"//YOURDOMAIN.com/script.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre> </div> <h3 id="headid-javascript-based-redirect">JavaScript-based redirect</h3> <p>There is, however, a case where the user specifically types in the URL without using HTTPS, and they’ll access the HTTP version of your website.</p> <p>The correct way of handling that would be to respond with a 301 “Moved permanently” HTTP code, and the browser would remember it for the next request. However, that’s not a possibility we have here, since we’re running on GitLab’s servers.</p> <p>A small hack you can do is to redirect your users with a bit of JavaScript code:</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="s2">"YOURDOMAIN.com"</span><span class="p">;</span>
<span class="k">if</span> <span class="p">((</span><span class="nx">host</span> <span class="o">==</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">!=</span> <span class="s1">'https:'</span><span class="p">))</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^http:/</span><span class="p">,</span> <span class="s2">"https:"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre> </div> <p>This redirects the user to the HTTPS version, but there are a few problems with it:</p> <ol> <li>a user could have JavaScript disabled, and would not be affected by that;</li> <li>an attacker could simply remove that code and behave as a <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">Man in the Middle</a>;</li> <li>the browser won’t remember the redirect instruction, so every time the user types that same URL, the website will have to redirect him/her again.</li> </ol> <h2 id="headid-wrap-up">Wrap up</h2> <p><img src="/images/201607/https.png" alt="https"/></p> <p>That’s how easy it is to have a free HTTPS-enabled website. With these tools, I see no reason not to do it.</p> <p>If you want to check the status of your HTTPS enabled website, <a href="https://www.ssllabs.com/ssltest/">SSL Labs offers a free online service</a> that “performs a deep analysis of the configuration of any SSL web server on the public Internet”.</p> <p>I hope it helps you :)</p> <div class="article-icons"> <span><i class="fa fa-tags"></i></span> <a href="https://www.flinhong.com/tags/#Jekyll" class="tags">Jekyll</a> <a href="https://www.flinhong.com/tags/#GitLab" class="tags">GitLab</a> <span><i class="fa fa-eye"></i></span><a href="javascripts:;" id="post_counter">1</a> </div> <div class="breaking-line"></div> </div> </div> <p>Share this post: <div class="addthis_sharing_toolbox"></div></p> <br/> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7353085750925432" data-ad-slot="4023614507" data-ad-format="auto"></ins> <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script> <div class="article-footer"> <div class="about-author"> <h2><span>About</span></h2> <div class="inner"> <a href="https://www.flinhong.com/about/" class="avatar avatar-large user-tooltip"> <img src="/assets/images/avatar.jpg" alt="Avatar" class="author-image setborder"/> </a> <div class="side"> <div class="about-head"> <a href="https://www.flinhong.com/about/" class="comment-user user-tooltip"><b>Frank Lin</b></a> </div> <i>林宏</i> <a href="http://lofter.flinhong.com"><i class="fa fa-camera"></i>Photo Galleries</a> <a href="https://www.flinhong.com/blog/"><i class="fa fa-comment"></i>Blog Posts</a> </div> <p>This blog is an exploration of my quirky thoughts and random adventures through life. I hope you enjoy reading and perusing my posts, please leave me a comment... I'd love to hear from you!</p> </div> </div> <div class="similar-posts"> <h2><span>Related Posts</span></h2> <div class="home-article right"> <ul> <li> <a href="https://www.flinhong.com/front-end/related-posts-in-jekyll/"> <span class="image-comments"><span class="disqus-comment-count" data-disqus-identifier="https://www.flinhong.com//front-end/related-posts-in-jekyll">0 Comments</span></span> <img src="/images/201607/related.jpg" alt="Related posts in Jekyll" title="Related posts in Jekyll"> <strong>Related posts in Jekyll</strong> <span class="a-txt">July 13, 2016</span> </a> </li> <li> <a href="https://www.flinhong.com/front-end/better-google-analytics-for-jekyll/"> <span class="image-comments"><span class="disqus-comment-count" data-disqus-identifier="https://www.flinhong.com//front-end/better-google-analytics-for-jekyll">0 Comments</span></span> <img src="/images/201607/ga.png" alt="Better quality of Google Analytics data for Jekyll blogs" title="Better quality of Google Analytics data for Jekyll blogs"> <strong>Better quality of Goog...</strong> <span class="a-txt">July 13, 2016</span> </a> </li> <li> <a href="https://www.flinhong.com/tips/jekyll-with-firebase/"> <span class="image-comments"><span class="disqus-comment-count" data-disqus-identifier="https://www.flinhong.com//tips/jekyll-with-firebase">0 Comments</span></span> <img src="/images/201607/firebase.png" alt="Host Jekyll Site on Google Firebase with free SSL" title="Host Jekyll Site on Google Firebase with free SSL"> <strong>Host Jekyll Site on Go...</strong> <span class="a-txt">July 02, 2016</span> </a> </li> </ul> </div> </div> </div> </div> <h2><span>Comments</span></h2> <div class="content-padding"> <div class="comment-part"> <div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://www.flinhong.com/front-end/lets-encrypt-with-gitlab-pages/",this.page.identifier="Frank Lin//front-end/lets-encrypt-with-gitlab-pages",this.page.title="Free SSL with Let's Encrypt on GitLab Pages"};!function(){var t=document,e=t.createElement("script");e.src="//flinhong.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> <aside id="sidebar" class="post-sidebar"> <div class="panel moved"> <h2>Social Connects</h2> <div class="panel-content socialize"> <a href="http://www.facebook.com/flinhong" target="_blank" class="strike-tooltip s-fb" title="Visit Facebook"><i class="fa fa-facebook"></i></a> <a href="https://twitter.com/flinhong" target="_blank" class="strike-tooltip s-tw" title="Visit Twitter"><i class="fa fa-twitter"></i></a> <a href="https://github.com/flinhong" target="_blank" class="strike-tooltip s-gh" title="Visit GitHub"><i class="fa fa-github"></i></a> <a href="http://weibo.com/linhong" target="_blank" class="strike-tooltip s-wb" title="Visit Weibo"><i class="fa fa-weibo"></i></a> <a href="https://www.linkedin.com/in/frankhl" target="_blank" class="strike-tooltip s-lk" title="Visit Linkedin"><i class="fa fa-linkedin"></i></a> </div> </div> <div class="panel moved"> <div class="panel-content"> <form action="/search/" target="_blank" method="get"> <input type="text" placeholder="Type and press enter..." name="q"> </form> </div> </div> <div class="panel toc-fix"> <h2>Table of Contents</h2> <div class="panel-content"> <div id="toc" class="toc-menu"></div> </div> </div> <div class="panel moved"> <h2>Accept Donations</h2> <div class="panel-content"> <div class="donation-widget"> <p>Your donation will encourage me to make my blog even better! If you don't want to donate or you don't have any money, don't worry, just enjoy it! 😙</p> <div class="donation-stats"> <a href="javascript:;" class="button" id="click-button">Make a donation</a><br/> <p id="qrcode"><img src="/assets/images/qrwechat.png" alt="QR Code"><br/>Scan the QR code to pay me with <a href="https://pay.weixin.qq.com/wechatpay">WeChat Pay</a>.<p> </div> </div> </div> </div> <div class="panel"> <h2>Recent Posts</h2> <div class="top-right"><a href="https://www.flinhong.com/blog/">View all</a></div> <div class="panel-content"> <div class="d-articles"> <div class="item"> <div class="item-header"> <a href="https://www.flinhong.com/tech/no-longer-if-support-for-asm/"><img src="/images/201607/impact_factor.jpg" alt="American Society for Microbiology (ASM) no longer supports impact factors for its journals"/></a> </div> <div class="item-content"> <h4><a href="https://www.flinhong.com/tech/no-longer-if-support-for-asm/">American Society for Microbiology (ASM) no longer supports impact factors for its journals</a></h4> <p>July 12, 2016</p> </div> </div> <div class="item"> <div class="item-header"> <a href="https://www.flinhong.com/reading/to-forget-to-memory/"><img src="/images/201607/post-mem.jpg" alt="为了忘却的纪念 - 七堇年"/></a> </div> <div class="item-content"> <h4><a href="https://www.flinhong.com/reading/to-forget-to-memory/">为了忘却的纪念 - 七堇年</a></h4> <p>July 07, 2016</p> </div> </div> <div class="item"> <div class="item-header"> <a href="https://www.flinhong.com/tips/fix-time-difference-bwtween-windows-and-ubuntu/"><img src="/images/201607/dual-boot.jpg" alt="Fix Time Difference Between Dual Boot Windows and Ubuntu"/></a> </div> <div class="item-content"> <h4><a href="https://www.flinhong.com/tips/fix-time-difference-bwtween-windows-and-ubuntu/">Fix Time Difference Between Dual Boot Windows and Ubuntu</a></h4> <p>July 06, 2016</p> </div> </div> <div class="item"> <div class="item-header"> <a href="https://www.flinhong.com/front-end/lets-encrypt-with-gitlab-pages/"><img src="/images/201607/lets-encrypt.png" alt="Free SSL with Let's Encrypt on GitLab Pages"/></a> </div> <div class="item-content"> <h4><a href="https://www.flinhong.com/front-end/lets-encrypt-with-gitlab-pages/">Free SSL with Let's Encrypt on GitLab Pages</a></h4> <p>July 06, 2016</p> </div> </div> <div class="item"> <div class="item-header"> <a href="https://www.flinhong.com/tips/jekyll-with-firebase/"><img src="/images/201607/firebase.png" alt="Host Jekyll Site on Google Firebase with free SSL"/></a> </div> <div class="item-content"> <h4><a href="https://www.flinhong.com/tips/jekyll-with-firebase/">Host Jekyll Site on Google Firebase with free SSL</a></h4> <p>July 02, 2016</p> </div> </div> </div> </div> </div> <div class="panel"> <h2>Latest Comments</h2> <div class="panel-content no-padding"> <div id="recent-comments"></div> </div> </div> <div class="panel moved"> <h2>Tag Cloud</h2> <div class="panel-content"> <div class="tagcloud"> <a href="https://www.flinhong.com/tags/#Ubuntu">Ubuntu</a><a href="https://www.flinhong.com/tags/#Jekyll">Jekyll</a><a href="https://www.flinhong.com/tags/#html">html</a><a href="https://www.flinhong.com/tags/#reading">reading</a><a href="https://www.flinhong.com/tags/#Hong Kong">Hong Kong</a><a href="https://www.flinhong.com/tags/#Olympus">Olympus</a><a href="https://www.flinhong.com/tags/#movie">movie</a><a href="https://www.flinhong.com/tags/#music">music</a><a href="https://www.flinhong.com/tags/#JavaScript">JavaScript</a><a href="https://www.flinhong.com/tags/#Disqus">Disqus</a><a href="https://www.flinhong.com/tags/#commercial">commercial</a><a href="https://www.flinhong.com/tags/#Sublime Text">Sublime Text</a><a href="https://www.flinhong.com/tags/#Evernote">Evernote</a><a href="https://www.flinhong.com/tags/#C#">C#</a><a href="https://www.flinhong.com/tags/#Git">Git</a><a href="https://www.flinhong.com/tags/#GitLab">GitLab</a><a href="https://www.flinhong.com/tags/#Windows">Windows</a><a href="https://www.flinhong.com/tags/#Liquid">Liquid</a><a href="https://www.flinhong.com/tags/#Google">Google</a><a href="https://www.flinhong.com/tags/#Impact Factors">Impact Factors</a><a href="https://www.flinhong.com/tags/#Google Analytics">Google Analytics</a><a href="https://www.flinhong.com/tags/#Bing">Bing</a> </div> </div> </div> </aside> <div class="clear-float"></div> </div> </section> </div> <div class="clear-float"></div> <div class="wrapper"> <div class="footer"> <div class="footer-top"></div> <div class="footer-content"> <div class="panel"> <h2>About</h2> <div class="panel-content"> <div> <p> Thanks for visiting my personal blog that generated by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> and proudly hosting on <a href="https://pages.github.com/" target="_blank"><i class="fa fa-github"></i> GitHub Pages</a> and <a href="https://firebase.google.com/"><i class="fa fa-google"></i> Google Firebase</a>. Except where otherwise noted, content on this site is licensed under the <a href="https://creativecommons.org/licenses/by-nc/4.0/" rel="nofollow" title="CC BY-NC 4.0 license" target="_blank"><i class="fa fa-creative-commons" aria-hidden="true"></i> CC BY-NC 4.0</a> for non-commercial use. </p> <span class="icon-line"> <i class="fa fa-line-chart"></i><span id="total_counter">7</span> pageviews </span> <span class="icon-line"> <i class="fa fa-clock-o"></i>Site updated at July 15, 2016. </span> <a href="mailto:franklin@flinhong.com" class="icon-line"> <i class="fa fa-envelope-o"></i><span>franklin@flinhong.com</span> </a> <span class="icon-line"> <i class="fa fa-map-marker"></i><span>CYC 807, HKU, Hong Kong, China</span> </span> </div> </div> </div> <div class="panel"> <h2>Recent Posts</h2> <div class="top-right"><a href="https://www.flinhong.com/blog/">View all</a></div> <div class="panel-content"> <div class="d-articles"> <div class="item"> <div class="item-header"> <a href="https://www.flinhong.com/tools/bing-dict-desktop/"><img src="/images/201607/bing.png" alt="Bing 必应词典桌面版"/></a> </div> <div class="item-content"> <h4><a href="https://www.flinhong.com/tools/bing-dict-desktop/">Bing 必应词典桌面版</a></h4> <p>July 13, 2016</p> </div> </div> <div class="item"> <div class="item-header"> <a href="https://www.flinhong.com/front-end/related-posts-in-jekyll/"><img src="/images/201607/related.jpg" alt="Related posts in Jekyll"/></a> </div> <div class="item-content"> <h4><a href="https://www.flinhong.com/front-end/related-posts-in-jekyll/">Related posts in Jekyll</a></h4> <p>July 13, 2016</p> </div> </div> <div class="item"> <div class="item-header"> <a href="https://www.flinhong.com/front-end/better-google-analytics-for-jekyll/"><img src="/images/201607/ga.png" alt="Better quality of Google Analytics data for Jekyll blogs"/></a> </div> <div class="item-content"> <h4><a href="https://www.flinhong.com/front-end/better-google-analytics-for-jekyll/">Better quality of Google Analytics data for Jekyll blogs</a></h4> <p>July 13, 2016</p> </div> </div> </div> </div> </div> <div class="panel"> <h2>Tag Cloud</h2> <div class="panel-content"> <div class="tagcloud"> <a href="https://www.flinhong.com/tags/#Ubuntu">Ubuntu</a><a href="https://www.flinhong.com/tags/#Jekyll">Jekyll</a><a href="https://www.flinhong.com/tags/#html">html</a><a href="https://www.flinhong.com/tags/#reading">reading</a><a href="https://www.flinhong.com/tags/#Hong Kong">Hong Kong</a><a href="https://www.flinhong.com/tags/#Olympus">Olympus</a><a href="https://www.flinhong.com/tags/#movie">movie</a><a href="https://www.flinhong.com/tags/#music">music</a><a href="https://www.flinhong.com/tags/#JavaScript">JavaScript</a><a href="https://www.flinhong.com/tags/#Disqus">Disqus</a><a href="https://www.flinhong.com/tags/#commercial">commercial</a><a href="https://www.flinhong.com/tags/#Sublime Text">Sublime Text</a><a href="https://www.flinhong.com/tags/#Evernote">Evernote</a><a href="https://www.flinhong.com/tags/#C#">C#</a><a href="https://www.flinhong.com/tags/#Git">Git</a><a href="https://www.flinhong.com/tags/#GitLab">GitLab</a><a href="https://www.flinhong.com/tags/#Windows">Windows</a><a href="https://www.flinhong.com/tags/#Liquid">Liquid</a><a href="https://www.flinhong.com/tags/#Google">Google</a><a href="https://www.flinhong.com/tags/#Impact Factors">Impact Factors</a><a href="https://www.flinhong.com/tags/#Google Analytics">Google Analytics</a><a href="https://www.flinhong.com/tags/#Bing">Bing</a> </div> </div> </div> </div> <div class="footer-bottom"> <div class="left">&copy; Copyright 2016 <strong>Frank Lin.</strong> All rights reserved.</div> <div class="right"> <ul> <li><a href="https://www.flinhong.com">Homepage</a></li> <li><a href="https://www.flinhong.com/blog/">Blog</a></li> <li><a href="http://lofter.flinhong.com">Photo Gallery</a></li> <li><a href="https://www.flinhong.com/feed.xml">RSS</a></li> <li><a href="https://www.flinhong.com/sitemap.xml">Sitemap</a></li> <li><a href="https://www.flinhong.com/about/">About</a></li> </ul> </div> <div class="clear-float"></div> </div> <a class="back-to-top" href="#"><span><i class="fa fa-chevron-up"></i></span></a> </div> </div> <script type='text/javascript' src='/jscript/jquery-1.11.2.min.js'></script> <script type='text/javascript' src='/jscript/modernizr.custom.50878.js'></script> <script type='text/javascript' src='/jscript/iscroll.js'></script> <script type='text/javascript' src='/jscript/dat-menu.js'></script> <script type='text/javascript' src="/jscript/jquery.fitvids.js"></script> <script type='text/javascript'>var strike_autostart=!1;</script> <script type='text/javascript' src='/jscript/theme-script.js'></script> <script type="text/javascript" src="/jscript/toc.js"></script> <script type="text/javascript">$(document).ready(function(){$("#toc").toc({headers:".article-content h1, .article-content h2, .article-content h3, .article-content h4, .article-content h5, .article-content h6"})});</script> <script type='text/javascript' src='/jscript/moment.min.js'></script> <script id="dsq-count-scr" src="//flinhong.disqus.com/count.js" async></script> <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-55d1d3f27f6078ce"></script> <script>!function(e,t,a,n,s,c,g){e.GoogleAnalyticsObject=s,e[s]=e[s]||function(){(e[s].q=e[s].q||[]).push(arguments)},e[s].l=1*new Date,c=t.createElement(a),g=t.getElementsByTagName(a)[0],c.async=1,c.src=n,g.parentNode.insertBefore(c,g)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-74593146-1","auto"),ga("send","pageview",{page:"/front-end/lets-encrypt-with-gitlab-pages/",title:"Free SSL with Let's Encrypt on GitLab Pages"});</script> <script src="https://www.gstatic.com/firebasejs/3.2.0/firebase.js"></script> <script>var config={apiKey:"AIzaSyB4_03lDxsfZN84-DgCikk3dPB6GnmQUIc",authDomain:"franks-blog.firebaseapp.com",databaseURL:"https://franks-blog.firebaseio.com",storageBucket:"franks-blog.appspot.com"};firebase.initializeApp(config);var flinhong=firebase.database().ref("pageviews"),current_url=decodeURI(window.location.pathname.replace(new RegExp("\\/|\\.","g"),"_"));flinhong.child("totalviews").on("value",function(n){var t=n.val();$("#total_counter").length>0&&t>1&&$("#total_counter").html(t)}),flinhong.child("posts/"+current_url).on("value",function(n){var t=n.val();$("#post_counter").length>0&&t>1&&$("#post_counter").html(t)}),flinhong.child("totalviews").transaction(function(n){return(n||0)+1}),flinhong.child("posts/"+current_url).transaction(function(n){return(n||0)+1});</script> </body> </html>